<%- include('partials/header', { title: 'Email Verification' }) %>

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="card">
        <div class="card-body text-center">
          <h2 class="card-title" id="message">Verifying...</h2>
          <p>Please wait while we verify your email.</p>
          <div id="loading" class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <div id="result" class="mt-3" style="display: none;">
            <a href="/" class="btn btn-primary">Go to Login</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(async () => {
  const urlParams = new URLSearchParams(window.location.search);
  const token = urlParams.get('token') || window.location.pathname.split('/').pop();

  try {
    const response = await fetch(`/api/users/verify/${token}`);
    const data = await response.json();

    document.getElementById('loading').style.display = 'none';
    document.getElementById('result').style.display = 'block';

    if (response.ok) {
      document.getElementById('message').textContent = data.message || "Email verified successfully!";
      document.getElementById('message').className = 'card-title text-success';
    } else {
      document.getElementById('message').textContent = data.error || "Verification failed.";
      document.getElementById('message').className = 'card-title text-danger';
    }
  } catch (error) {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('result').style.display = 'block';
    document.getElementById('message').textContent = "An error occurred. Please try again.";
    document.getElementById('message').className = 'card-title text-danger';
    console.error(error);
  }
})();
</script>

<%- include('partials/footer') %>
